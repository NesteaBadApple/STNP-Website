<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STNP Homepage</title>
<link rel="stylesheet" href="home.css">
</head>
<body>  

<!-- NAVBAR -->
<div class="navbar">
    <h1>STNP</h1>
    <input type="text" placeholder="Search Reddit">
    <div class="settings-btn" id="settingsBtn">⚙️</div>
</div>

<!-- SETTINGS PANEL -->
<div class="settings-panel" id="settingsPanel">
    <h3>Settings</h3>

    <div class="theme-toggle">
        <label for="modeSwitch">Dark Mode</label>
        <input type="checkbox" id="modeSwitch">
    </div>

    <button id="profileBtn" class="profile-btn">View Profile</button>
    <button id="logoutBtn" class="logout-btn">Logout</button>
</div>

<!-- PAGE LAYOUT -->
<div class="layout">

    <!-- LEFT SIDEBAR -->
    <div class="sidebar-left">
        <h3>Menu</h3>
        <ul>
            <li>Home</li>

        </ul>
    </div>

    <!-- MAIN FEED -->
    <div class="feed">

        <!-- CREATE POST -->
        <div class="create-post">
            <h3>Create a Post</h3>

            <input id="postTitle" type="text" placeholder="Post title">
            <textarea id="postText" placeholder="Text (optional)"></textarea>
            <input id="postImage" type="file" accept="image/*">

            <button id="postBtn">Post</button>
        </div>

        <!-- FEED CONTAINER -->
        <div id="postFeed"></div>

    </div>


</div>

<script>
/*-----------------------------------------
   THEME (LIGHT / DARK)
------------------------------------------*/
const modeSwitch = document.getElementById("modeSwitch");

// Load saved theme
let savedTheme = localStorage.getItem("theme") || "light"; // default light
document.body.classList.remove("light", "dark");
document.body.classList.add(savedTheme);
modeSwitch.checked = savedTheme === "dark";

// Toggle theme
modeSwitch.onchange = () => {
    if (modeSwitch.checked) {
        document.body.classList.remove("light");
        document.body.classList.add("dark");
        localStorage.setItem("theme", "dark");
    } else {
        document.body.classList.remove("dark");
        document.body.classList.add("light");
        localStorage.setItem("theme", "light");
    }
};

/*-----------------------------------------
   SETTINGS & NAVIGATION
------------------------------------------*/
document.getElementById("settingsBtn").onclick = () => {
    const panel = document.getElementById("settingsPanel");
    panel.style.display = panel.style.display === "block" ? "none" : "block";
};

document.getElementById("profileBtn").onclick = () => {
    window.location.href = "profile.html";
};

document.getElementById("logoutBtn").onclick = () => {
    alert("You are now logged out.");
    window.location.href = "login.php";
};

/*-----------------------------------------
   POST SYSTEM WITH LOCAL STORAGE
------------------------------------------*/
let savedPosts = JSON.parse(localStorage.getItem("posts")) || [];

// Load posts
window.onload = () => {
    savedPosts.forEach(post => renderPost(post, false));
};

const postTitle = document.getElementById("postTitle");
const postText = document.getElementById("postText");
const postImage = document.getElementById("postImage");
const postBtn = document.getElementById("postBtn");
const postFeed = document.getElementById("postFeed");

postBtn.onclick = async () => {
    if (postTitle.value.trim() === "") {
        alert("Title is required!");
        return;
    }

    let imageBase64 = "";
    if (postImage.files.length > 0) {
        imageBase64 = await toBase64(postImage.files[0]);
    }

    const newPost = {
        id: Date.now(),
        title: postTitle.value,
        text: postText.value,
        image: imageBase64,
        votes: 0,
        created: Date.now()
    };

    savedPosts.unshift(newPost);
    localStorage.setItem("posts", JSON.stringify(savedPosts));

    renderPost(newPost, true);

    postTitle.value = "";
    postText.value = "";
    postImage.value = "";
};

/*-----------------------------------------
   BASE64 HELPER
------------------------------------------*/
function toBase64(file) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.readAsDataURL(file);
    });
}

/*-----------------------------------------
   TIME AGO FORMATTER (Reddit-style)
------------------------------------------*/
function timeAgo(timestamp) {
    const now = Date.now();
    const diff = Math.floor((now - timestamp) / 1000); // seconds

    if (diff < 60) return "Just now";

    const minutes = Math.floor(diff / 60);
    if (minutes < 60) return minutes === 1 ? "1 minute ago" : `${minutes} minutes ago`;

    const hours = Math.floor(minutes / 60);
    if (hours < 24) return hours === 1 ? "1 hour ago" : `${hours} hours ago`;

    const days = Math.floor(hours / 24);
    return days === 1 ? "1 day ago" : `${days} days ago`;
}

/*-----------------------------------------
   RENDER POST
------------------------------------------*/
function renderPost(data, prepend = true) {
    const post = document.createElement("div");
    post.classList.add("post");

    post.innerHTML = `
        <div class="vote-box">
            <div class="upvote">▲</div>
            <div class="vote-count">${data.votes}</div>
            <div class="downvote">▼</div>
        </div>

        <div class="post-body">
            <div class="post-title">${data.title}</div>
            <div class="post-info" data-time="${data.created}">
                ${timeAgo(data.created)}
            </div>
            <div class="post-content">
                ${data.text ? `<p>${data.text}</p>` : ""}
                ${data.image ? `<img src="${data.image}" class="post-img">` : ""}
            </div>
        </div>
    `;

    enableVoting(post, data.id);

    if (prepend) postFeed.prepend(post);
    else postFeed.append(post);
}

/*-----------------------------------------
   VOTING SYSTEM
------------------------------------------*/
function enableVoting(postElement, postID) {
    const up = postElement.querySelector(".upvote");
    const down = postElement.querySelector(".downvote");
    const count = postElement.querySelector(".vote-count");

    let voteState = 0;

    up.onclick = () => {
        if (voteState === 1) {
            voteState = 0;
            count.textContent--;
        } else {
            if (voteState === -1) count.textContent++;
            voteState = 1;
            count.textContent++;
        }
        updateVotes(postID, count.textContent);
    };

    down.onclick = () => {
        if (voteState === -1) {
            voteState = 0;
            count.textContent++;
        } else {
            if (voteState === 1) count.textContent--;
            voteState = -1;
            count.textContent--;
        }
        updateVotes(postID, count.textContent);
    };
}

function updateVotes(id, newVoteCount) {
    savedPosts = savedPosts.map(post =>
        post.id === id ? { ...post, votes: newVoteCount } : post
    );
    localStorage.setItem("posts", JSON.stringify(savedPosts));
}

/*-----------------------------------------
   LIVE TIME UPDATER (EVERY 60 SECONDS)
------------------------------------------*/
setInterval(() => {
    document.querySelectorAll(".post-info").forEach(el => {
        const timestamp = parseInt(el.getAttribute("data-time"));
        el.textContent = timeAgo(timestamp);
    });
}, 60000);

</script>

</body>
</html>
